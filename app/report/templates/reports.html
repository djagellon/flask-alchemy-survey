{% extends 'home.html' %}

{% macro admin_data(answer, action) %}
  <div class="admin report-footer">
    <span class="label label-default">{{answer.datalabel}}</span>
    <span class="label label-default">{{action}}</span>

    {% if answer.weight %}
      <span class="label label-default">weight:{{answer.weight}}</span>
      <span class="label label-default">score:{{answer.score}}</span>
    {% endif %}

    {% if answer.notes %}
      <h6>notes: <em>{{answer.notes}}</em></h6>
    {% endif %}
  </div>
{% endmacro %}

{% block header %}
  <h1>{% block title %}Report{% endblock %}</h1>
{% endblock %}

{% block content %}
<h3> Report for Module: {{module}}</h3> 

<div class="panel-group" id="accordion" aria-multiselectable="true">
  {% for answer in data %}
    {% if answer.actions %}
      {% for action in answer.actions %}
        {% set status = answer.actions[action]['complete']%}
        {% set collapse_label = action.replace('.', '_') %}
        <div class="panel panel-default" role="tab" data-answer="{{action}}" id="heading_{{collapse_label}}">
          <div class="panel-body">
            <div class="row">
              <div class="col-md-11">
                <h5>{{ answer.actions[action]['plan'] }}</h5>
              </div>
              <div class="col-md-1">
                <button 
                  data-status="{{ status }}" 
                  class="mark-complete btn btn-xs {{'btn-success' if status else 'btn-warning'}}">
                  {{ 'Complete' if status else 'Incomplete' }}
                </button>
              </div>
            </div>
          </div>

          <div id="collapse_{{collapse_label}}" role="tabpanel" aria-labeledby="heading_{{collapse_label}}" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="short_output">
                {{answer['short']}}
              </div>
              <div class="long_output">
                <br/>
                {{answer['long']}}
              </div>
            </div>
          </div>


          <div class="panel-footer clickable" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse_{{collapse_label}}" aria-expanded="false" aria-controls="collapse_{{collapse_label}}">
          {% if current_user.is_admin and current_user.admin_controls_on %}
            {{admin_data(answer, action)}}
          {% endif %}

            <span class="expand_footer_text pull-right"> 
                <i class="more_collapsed glyphicon glyphicon-plus"></i>
                <i class="more_expanded glyphicon glyphicon-minus"></i>
            </span>
                <div class="clearfix"></div>
          </div>
        </div>
      {% endfor%}
    {% endif %}
  {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
    {{super()}}
        <script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.18/datatables.min.js"></script>
        <script type="text/javascript" src={{url_for("static", filename="js/report.js")}}></script>
{% endblock %}
